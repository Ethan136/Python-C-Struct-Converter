## 新功能規劃文件：GUI資料結構輸入方式擴充

### 1. 目標
- 提供使用者在GUI介面上，除了現有的「載入.H檔」外，還能「直接在介面上設定資料結構」。
- 兩種資料結構輸入方式可透過Tab切換。

---

### 2. 功能細節

#### 2.1 Tab切換機制
- 介面上新增Tab元件，分為：
  - 「載入.H檔」Tab（現有功能）
  - 「手動設定資料結構」Tab（新功能）

#### 2.2 手動設定資料結構（新功能）
- 使用者可在GUI上直接設定資料結構，流程如下：

  1. **設定資料結構總大小（size）**
     - 輸入框或下拉選單，讓使用者指定結構體的總bit數或byte數。

  2. **設定Bitfield與對應成員名稱**
     - 動態表格或列表，讓使用者逐一新增bitfield。
     - 每一列包含：
       - bitfield長度（bit數）
       - 對應的struct member名稱
     - 可新增、刪除、調整順序。

  3. **記憶體緊密排列**
     - 由於此模式下不允許padding，所有bitfield會緊密排列，總長度必須等於結構體總大小。
     - 若bitfield總和不等於結構體大小，需提示使用者修正。

#### 2.3 載入.H檔（現有功能保留）
- 保持現有從外部載入C語言.H檔案的機制不變。

---

### 3. 介面設計建議

- Tab元件明顯標示兩種模式。
- 「手動設定資料結構」Tab下，提供：
  - 結構體大小設定區
  - Bitfield設定表格
  - 新增/刪除bitfield按鈕
  - 即時顯示目前bitfield總長度與結構體大小的對比
  - 錯誤提示（如bitfield總長度不符）

---

### 4. 其他注意事項

- 兩種模式下產生的資料結構，後續處理流程應一致。
- 若有需要，可考慮將手動設定的資料結構匯出為.H檔，或直接進行後續轉換。

---

### 5. UI Wireframe（介面線框圖）

#### 5.1 Tab切換主畫面

```
+---------------------------------------------------+
| [載入.H檔] | [手動設定資料結構]                  |
+---------------------------------------------------+
|                                                   |
|  (根據所選Tab顯示對應內容)                        |
|                                                   |
+---------------------------------------------------+
```

#### 5.2 手動設定資料結構Tab內容

```
+---------------------------------------------------+
| 結構體總大小（bits/bytes）：[_________]           |
+---------------------------------------------------+
| Bitfield 設定：                                   |
| +-------+-------------------+----------+          |
| | 長度  | 成員名稱          | 操作     |          |
| +-------+-------------------+----------+          |
| |  8    | version           | 刪除     |          |
| | 16    | id                | 刪除     |          |
| | ...   | ...               | 刪除     |          |
| +-------+-------------------+----------+          |
| [新增Bitfield]                                   |
+---------------------------------------------------+
| Bitfield總長度：24 bits / 結構體大小：24 bits     |
| [提示] Bitfield總長度需等於結構體大小            |
+---------------------------------------------------+
| [儲存] [匯出為.H檔] [重設]                        |
+---------------------------------------------------+
```

#### 5.3 UI設計圖（示意圖）

> 下圖為手動設定資料結構Tab的UI設計示意：

```
+---------------------------------------------------------------+
| [載入.H檔] | [手動設定資料結構]                                |
+---------------------------------------------------------------+
| 結構體總大小： [_____] bits/bytes                             |
+---------------------------------------------------------------+
| Bitfield 設定                                                |
| +-------+-------------------+----------+-------------------+ |
| | #     | 成員名稱          | 長度(bit)| 操作              | |
| +-------+-------------------+----------+-------------------+ |
| | 1     | version           |   8      | [刪除] [上] [下]  | |
| | 2     | id                |   16     | [刪除] [上] [下]  | |
| | ...   | ...               |   ...    | [刪除] [上] [下]  | |
| +-------+-------------------+----------+-------------------+ |
| [新增Bitfield]                                               |
+---------------------------------------------------------------+
| Bitfield總長度：24 bits / 結構體大小：24 bits                 |
| [提示] Bitfield總長度需等於結構體大小                        |
+---------------------------------------------------------------+
| [儲存] [匯出為.H檔] [重設]                                    |
+---------------------------------------------------------------+
```

- 「新增Bitfield」按鈕可在表格下方，點擊後彈出輸入欄位或直接新增一列。
- 操作欄提供「刪除」、「上移」、「下移」功能，方便調整bitfield順序。
- 錯誤提示（如bitfield總長度不符）以紅色文字顯示於提示區。
- 匯出、儲存、重設按鈕置於底部，操作明確。

---

### 6. 流程圖

#### 6.1 手動設定資料結構流程

```
[進入手動設定Tab]
      |
      v
[輸入結構體總大小]
      |
      v
[新增/編輯Bitfield]
      |
      v
[檢查Bitfield總長度是否等於結構體大小]
      |Yes                |No
      |                   |
      v                   v
[允許儲存/匯出]      [顯示錯誤提示，禁止儲存]
```

---

### 7. 技術細節建議

#### 7.1 前端技術建議
- **框架**：建議使用 React、Vue 或 PyQt（若為桌面應用）
- **UI元件**：Tab、表格、動態表單、即時驗證提示
- **狀態管理**：
  - Tab切換狀態
  - 結構體大小與bitfield列表
  - Bitfield總長度即時計算與驗證
- **匯出功能**：
  - 將手動設定的資料結構轉換為C語言struct格式，並可下載為.H檔

#### 7.2 資料結構建議
- 以物件陣列儲存bitfield資訊：
  ```json
  [
    { "name": "version", "length": 8 },
    { "name": "id", "length": 16 }
  ]
  ```
- 結構體大小單獨存放，bitfield總長度需與之比對
- 匯出時自動產生無padding的C struct bitfield語法

#### 7.3 驗證與提示
- Bitfield總長度與結構體大小不符時，顯示錯誤並禁止儲存/匯出
- 成員名稱不可重複，bitfield長度需為正整數

#### 7.4 其他
- 可考慮支援多語系（如中英文切換）
- 若未來需支援更複雜的struct（如巢狀struct），可預留擴充空間

---

如需更進一步的UI設計圖或程式碼範例，請再告知！ 