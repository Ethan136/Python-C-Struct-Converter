<?xml version="1.0" encoding="UTF-8"?>
<manual_struct_tests>
    <test_case name="bitfield_layout">
        <members>
            <member name="a" type="unsigned int" bit_size="3"/>
            <member name="b" type="unsigned int" bit_size="5"/>
            <member name="c" type="unsigned int" bit_size="8"/>
        </members>
        <total_size>4</total_size>
        <expected_layout>
            <item name="a" type="unsigned int" offset="0" size="4" bit_offset="0" bit_size="3"/>
            <item name="b" type="unsigned int" offset="0" size="4" bit_offset="3" bit_size="5"/>
            <item name="c" type="unsigned int" offset="0" size="4" bit_offset="8" bit_size="8"/>
        </expected_layout>
    </test_case>
    <test_case name="manual_struct_byte_bit_size">
        <members>
            <member name="a" type="char" bit_size="8"/>
            <member name="b" type="unsigned int" bit_size="12"/>
            <member name="c" type="short" bit_size="8"/>
            <member name="d" type="unsigned int" bit_size="4"/>
        </members>
        <total_size>16</total_size>
        <expected_layout>
            <item name="a" type="char" offset="0" size="1" bit_size="8"/>
            <item name="b" type="unsigned int" offset="4" bit_offset="0" bit_size="12"/>
            <item name="c" type="short" offset="8" size="2" bit_size="8"/>
            <item name="(padding)" type="padding" offset="10" size="2" bit_size="16"/>
            <item name="d" type="unsigned int" offset="12" bit_offset="0" bit_size="4"/>
        </expected_layout>
    </test_case>
    <test_case name="anonymous_bitfield">
        <members>
            <member name="a" type="int" bit_size="3"/>
            <member name="" type="int" bit_size="2"/>
            <member name="b" type="int" bit_size="5"/>
        </members>
        <total_size>4</total_size>
        <expected_layout>
            <item name="a" type="int" offset="0" size="4" bit_offset="0" bit_size="3"/>
            <item name="" type="int" offset="0" size="4" bit_offset="3" bit_size="2"/>
            <item name="b" type="int" offset="0" size="4" bit_offset="5" bit_size="5"/>
        </expected_layout>
    </test_case>
    <test_case name="manual_struct_error">
        <members>
            <member name="a" type="char" bit_size="-1"/>
            <member name="b" type="short" bit_size="0"/>
        </members>
        <total_size>10</total_size>
        <expect_error>bit_size 需為 0 或正整數</expect_error>
    </test_case>
    <test_case name="duplicate_member_name">
        <members>
            <member name="a" type="int" bit_size="0"/>
            <member name="a" type="char" bit_size="0"/>
        </members>
        <total_size>8</total_size>
        <expect_error>成員名稱 'a' 重複</expect_error>
    </test_case>
    <test_case name="invalid_bit_size">
        <members>
            <member name="a" type="int" bit_size="-1"/>
        </members>
        <total_size>4</total_size>
        <expect_error>bit_size 需為 0 或正整數</expect_error>
    </test_case>
    <test_case name="invalid_total_size">
        <members>
            <member name="a" type="int" bit_size="0"/>
        </members>
        <total_size>-1</total_size>
        <expect_error>結構體大小需為正整數</expect_error>
    </test_case>
</manual_struct_tests> 